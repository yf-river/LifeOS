# 实施规划

功能分支: `002-second-req-dev`
生成时间: 2026-01-03
状态: 待实施

---

## 项目概述

| 项目 | 说明 |
|------|------|
| 目标 | 1:1 复刻 Get笔记 Web 前端 + 全栈 AI 功能 |
| 预期工期 | 4-6 周 |
| 预期还原度 | 90-95% |
| 技术栈 | Next.js 14 + Go/go-zero + PostgreSQL |

---

## 技术上下文

### 已确定

| 类别 | 选型 |
|------|------|
| 前端框架 | Next.js 14 (App Router) |
| UI 组件库 | shadcn/ui + Tailwind CSS |
| 状态管理 | Zustand |
| 富文本编辑器 | Tiptap 2.x |
| 后端框架 | Go 1.21 + go-zero |
| ORM | GORM |
| 数据库 | PostgreSQL 15 |
| AI OCR | 腾讯云通用印刷体识别 |
| AI ASR | 腾讯云实时语音识别 |
| AI LLM | DeepSeek API |
| 文件存储 | 腾讯云 COS |

### 关键决策 (Clarifications)

1. **后端策略**: 全栈实现，含所有 AI 功能
2. **内容存储**: `json_content` 主存储，`content` 后端生成用于搜索
3. **冲突处理**: 弹窗提示 + 剪贴板保留用户输入
4. **前端技术栈**: shadcn/ui + Tailwind + Zustand

---

## 章程合规检查

| 章程原则 | 设计决策 | 合规 |
|----------|----------|------|
| Local-First | PostgreSQL 可自托管，数据存本地 | ✅ |
| Invisible AI | AI 自动生成标签/摘要，不打扰用户 | ✅ |
| 前后端分离 | Next.js + go-zero 独立部署 | ✅ |
| 安全性 | JWT + CSRF，敏感数据加密 | ✅ |
| 代码质量 | TypeScript + Go 强类型 | ✅ |
| 文档驱动 | spec → plan → tasks → code | ✅ |

---

## 实施阶段

### Phase 1: 基础框架 (Week 1)

**目标**: 搭建前后端骨架，实现基本运行

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 1.1 创建 Next.js 项目，配置 Tailwind + shadcn/ui | P0 | 2h |
| 1.2 创建 go-zero 项目，配置 GORM + PostgreSQL | P0 | 2h |
| 1.3 实现三栏布局框架 (175px + 774px + 280px) | P0 | 4h |
| 1.4 配置 Docker Compose 开发环境 | P1 | 2h |
| 1.5 实现 JWT 认证中间件 | P0 | 3h |

**交付物**:
- [ ] 前端项目骨架
- [ ] 后端项目骨架
- [ ] Docker 开发环境
- [ ] 基础布局组件

### Phase 2: 笔记 CRUD (Week 1-2)

**目标**: 实现核心笔记功能，与 Get笔记 API 格式兼容

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 2.1 实现 notes 表数据模型 | P0 | 2h |
| 2.2 实现笔记列表 API + 前端组件 | P0 | 4h |
| 2.3 实现笔记详情 API + 前端组件 | P0 | 3h |
| 2.4 实现笔记创建 API + 前端表单 | P0 | 4h |
| 2.5 实现笔记更新 API (含乐观锁) | P0 | 4h |
| 2.6 实现笔记删除 API + 确认弹窗 | P0 | 2h |
| 2.7 实现版本冲突处理 (弹窗 + 剪贴板) | P0 | 3h |

**交付物**:
- [ ] 笔记 CRUD API (5 个端点)
- [ ] 笔记列表页面
- [ ] 笔记详情页面
- [ ] 乐观锁冲突处理

### Phase 3: Tiptap 编辑器 (Week 2)

**目标**: 还原 Get笔记 编辑器体验

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 3.1 集成 Tiptap 基础扩展 (StarterKit) | P0 | 2h |
| 3.2 配置文本格式扩展 (Bold, Italic, 等) | P0 | 2h |
| 3.3 配置块级元素扩展 (Heading, List, 等) | P0 | 3h |
| 3.4 实现 json_content ↔ 编辑器状态同步 | P0 | 4h |
| 3.5 实现 Placeholder 和自动保存 | P1 | 3h |
| 3.6 实现工具栏 UI (参考 Get笔记) | P0 | 4h |
| 3.7 样式调优 (CSS 变量对齐 Get笔记) | P1 | 4h |

**交付物**:
- [ ] Tiptap 编辑器组件
- [ ] 工具栏组件
- [ ] 自动保存功能
- [ ] 编辑器样式 (与 Get笔记 一致)

### Phase 4: 标签系统 (Week 2-3)

**目标**: 实现完整标签功能

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 4.1 实现 tags + note_tags 数据模型 | P0 | 2h |
| 4.2 实现标签 CRUD API | P0 | 3h |
| 4.3 实现标签列表组件 (侧边栏) | P0 | 3h |
| 4.4 实现笔记标签选择器 | P0 | 3h |
| 4.5 实现标签样式 (系统标签 + 用户标签) | P1 | 2h |
| 4.6 实现按标签筛选笔记 | P0 | 2h |

**交付物**:
- [ ] 标签 API (3 个端点)
- [ ] 标签页面
- [ ] 标签选择器组件
- [ ] 按标签筛选功能

### Phase 5: AI 功能 (Week 3-4)

**目标**: 实现 AI 智能识别功能

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 5.1 集成腾讯云 OCR SDK | P0 | 4h |
| 5.2 实现图片上传 + OCR 识别 | P0 | 6h |
| 5.3 集成 DeepSeek API | P0 | 3h |
| 5.4 实现 AI 标签生成 | P0 | 4h |
| 5.5 实现 AI 摘要生成 | P1 | 4h |
| 5.6 实现链接抓取 + AI 分析 | P1 | 6h |
| 5.7 集成腾讯云 ASR SDK | P1 | 4h |
| 5.8 实现音视频上传 + 转文字 | P2 | 8h |
| 5.9 实现异步任务状态查询 | P1 | 4h |

**交付物**:
- [ ] 图片 OCR 功能
- [ ] AI 标签生成
- [ ] AI 摘要生成
- [ ] 链接 AI 分析
- [ ] 音视频转文字 (可选)

### Phase 6: 文件存储 (Week 4)

**目标**: 实现文件上传和存储

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 6.1 集成腾讯云 COS SDK | P0 | 3h |
| 6.2 实现图片上传接口 | P0 | 4h |
| 6.3 实现图片压缩和缩略图 | P1 | 3h |
| 6.4 实现音视频分片上传 | P2 | 6h |
| 6.5 实现附件管理 | P1 | 3h |

**交付物**:
- [ ] 文件上传 API
- [ ] COS 集成
- [ ] 图片压缩

### Phase 7: UI 精调 (Week 5)

**目标**: 对齐 Get笔记 视觉效果

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 7.1 对齐 CSS 变量 (配色、间距) | P0 | 4h |
| 7.2 实现响应式布局 | P1 | 4h |
| 7.3 实现加载状态 (骨架屏) | P1 | 3h |
| 7.4 实现空状态设计 | P1 | 2h |
| 7.5 实现 Toast 通知 | P0 | 2h |
| 7.6 实现动画效果 | P2 | 4h |
| 7.7 UI 走查和修复 | P0 | 8h |

**交付物**:
- [ ] 与 Get笔记 90%+ 视觉一致
- [ ] 响应式适配
- [ ] 完整交互反馈

### Phase 8: 测试和部署 (Week 5-6)

**目标**: 保证质量，完成上线

| 任务 | 优先级 | 预估 |
|------|--------|------|
| 8.1 编写后端单元测试 | P0 | 8h |
| 8.2 编写前端组件测试 | P1 | 6h |
| 8.3 编写 E2E 测试 | P2 | 6h |
| 8.4 性能优化 | P1 | 4h |
| 8.5 安全审计 | P0 | 4h |
| 8.6 编写部署文档 | P0 | 2h |
| 8.7 CI/CD 配置 | P1 | 4h |

**交付物**:
- [ ] 测试覆盖率 > 70%
- [ ] 部署文档
- [ ] CI/CD 流水线

---

## 里程碑

| 里程碑 | 目标日期 | 交付物 |
|--------|----------|--------|
| M1 | Week 1 | 基础框架 + 布局 |
| M2 | Week 2 | 笔记 CRUD + 编辑器 |
| M3 | Week 3 | 标签系统 + 部分 AI |
| M4 | Week 4 | 完整 AI 功能 |
| M5 | Week 5 | UI 精调完成 |
| M6 | Week 6 | 测试 + 部署 |

---

## 风险和缓解

| 风险 | 等级 | 缓解措施 |
|------|------|----------|
| Tiptap 扩展兼容性 | 中 | 逐步添加扩展，充分测试 |
| AI 服务延迟 | 低 | 异步处理 + 进度显示 |
| 乐观锁冲突 | 低 | 前端自动重试 + 用户提示 |
| 大文件上传 | 中 | 分片上传 + 断点续传 |
| UI 还原度 | 中 | 参考爬取数据，逐像素对比 |

---

## 依赖文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 功能规范 | [spec.md](./spec.md) | 详细需求 |
| 数据模型 | [data-model.md](./data-model.md) | 数据库设计 |
| API 契约 | [contracts/api-spec.yaml](./contracts/api-spec.yaml) | OpenAPI 规范 |
| 技术研究 | [research.md](./research.md) | 技术选型理由 |
| 快速启动 | [quickstart.md](./quickstart.md) | 开发环境搭建 |
| 原始 API | [api-reference.md](./api-reference.md) | Get笔记 API 参考 |

---

## 下一步

1. 运行 `/tasks` 生成详细任务列表
2. 创建 GitHub Issues 或任务跟踪
3. 开始 Phase 1 实施
