# 5个参考项目探索总结

## 文档概览

本次深度探索已生成 3 份详细文档，供 Prism 重构时参考。

| 文档 | 内容 | 用途 |
|------|------|------|
| **深度分析-5个参考项目.md** | 架构级别分析 | 理解设计思想和实现模式 |
| **技术选型对比表.md** | 技术栈和功能对比 | 做出技术决策 |
| **代码实现参考.md** | 代码示例和最佳实践 | 具体编码参考 |

---

## 快速导航

### 如果你想了解...

#### 1. 完整的架构理解
**推荐阅读**: 深度分析-5个参考项目.md
- FastGPT 工作流编排
- memos 极简 API 设计
- blinko 本地优先 + MCP 集成
- khoj 多端客户端架构
- WeKnora GraphRAG 和微服务分离

#### 2. 技术选型和对比
**推荐阅读**: 技术选型对比表.md
- 技术栈矩阵
- 数据库选择建议
- API 设计方案对比
- 性能特征对比
- 扩展性评估

#### 3. 具体代码实现
**推荐阅读**: 代码实现参考.md
- gRPC-Gateway API 设计 (memos 模式)
- tRPC 类型安全 API (blinko 模式)
- Prisma 数据库 Schema 设计
- PostgreSQL + PG Vector 配置
- 工作流执行引擎 (FastGPT 模式)
- MCP 集成 (作为服务器和客户端)
- 混合搜索实现

---

## 关键发现总结

### 架构决策

**推荐方案**: Go + React + Tauri 组合
```
后端:      Go + Gin (轻量、快速、原生并发)
前端:      React 18 + TypeScript (主流)
桌面:      Tauri v2 (轻量、安全、性能好)
API:       gRPC-Gateway (类型安全、自动文档)
DB:        PostgreSQL + PG Vector (一体化向量搜索)
本地优先:  SQLite (离线优先)
LLM:       Ollama (本地模型)
扩展:      MCP (标准化工具协议)
```

### 核心功能优先级

**第一阶段 (MVP)**:
- ✓ 笔记 CRUD (基础)
- ✓ 时间轴展示 (memos 风格)
- ✓ 全文搜索 (SQLite FTS)
- ✓ 本地存储 (SQLite)

**第二阶段 (AI 能力)**:
- ✓ 向量搜索 (PG Vector)
- ✓ 混合检索 (向量 + 全文)
- ✓ 工具定义 (标准化)
- ✓ MCP 集成

**第三阶段 (工作流)**:
- ✓ 节点编排 (参考 FastGPT)
- ✓ Agent 能力
- ✓ 工作流执行引擎

**第四阶段 (高级)**:
- ✓ GraphRAG (知识图谱)
- ✓ 自动链接 (语义相似度)
- ✓ 多端同步

### 最佳实践提取

#### API 设计
- **采用 Protocol Buffers**: 类型安全 + 自动生成文档
- **gRPC-Gateway**: 同时支持 gRPC 和 REST
- **版本管理**: `/api/v1/` 路径前缀
- **错误处理**: gRPC 标准错误码

#### 数据库
- **本地应用**: SQLite (全功能、零配置)
- **服务端**: PostgreSQL (生产级、可扩展)
- **向量存储**: PG Vector (集成度高) vs Milvus (高性能)
- **搜索**: SQLite FTS (简单) vs Elasticsearch (复杂)

#### AI 工作流
- **节点化执行**: 每个节点独立执行和验证
- **工具标准化**: MCP 协议作为标准
- **上下文管理**: 三层分离 (长期 + 短期 + 当前)
- **混合检索**: 向量 + 关键字 + 重排

#### 代码组织
- **Monorepo**: 前后端代码共享 (pnpm workspaces)
- **模块化**: 按功能分离 (Service + Repository + Handler)
- **类型安全**: TypeScript 或 Protocol Buffers
- **测试**: 单元测试 + 集成测试

---

## 对各项目的简评

### FastGPT ⭐⭐⭐⭐
**最适合学习**: 工作流编排、AI 能力集成
**代码复杂度**: 高
**应用场景**: AI Agent 平台构建
**对 Prism 的启示**: 
- 工作流执行引擎设计
- 工具链标准化
- 多知识库管理

### memos ⭐⭐⭐⭐⭐
**最适合学习**: API 设计、轻量级架构
**代码复杂度**: 低
**应用场景**: 快速原型、MVP 开发
**对 Prism 的启示**:
- gRPC-Gateway 模式
- 极简 API 设计
- SQLite 到 PostgreSQL 的迁移路径

### blinko ⭐⭐⭐⭐⭐
**最适合学习**: 本地优先设计、MCP 集成、Tauri 应用
**代码复杂度**: 中
**应用场景**: 本地优先应用、离线优先
**对 Prism 的启示**:
- Tauri 桌面应用实现
- MCP 深度集成
- tRPC 类型安全 API
- Prisma 数据库管理

### khoj ⭐⭐⭐⭐
**最适合学习**: 多端客户端、RAG 实现、Python/FastAPI
**代码复杂度**: 中
**应用场景**: 多端应用、内容处理
**对 Prism 的启示**:
- 多端架构分离
- 内容导入和处理
- 插件化设计

### WeKnora ⭐⭐⭐
**最适合学习**: GraphRAG、文档处理、微服务
**代码复杂度**: 高
**应用场景**: 高级 RAG、复杂文档处理
**对 Prism 的启示**:
- 知识图谱构建
- 异构数据处理
- 微服务架构
- DuckDB 分析

---

## 立即可用的代码片段

### 1. API 服务器基础 (Go + Gin)
```go
package main

import "github.com/gin-gonic/gin"

func main() {
  r := gin.Default()
  
  // 健康检查
  r.GET("/health", func(c *gin.Context) {
    c.JSON(200, gin.H{"status": "ok"})
  })
  
  r.Run(":8080")
}
```

### 2. 数据库连接 (Prisma)
```bash
npx prisma init
npx prisma migrate dev --name init
```

### 3. 前端项目 (Next.js + tRPC)
```bash
pnpm create next-app@latest
pnpm add trpc @trpc/react-query zod
```

### 4. 向量搜索 (PG Vector)
```sql
CREATE EXTENSION vector;
CREATE TABLE embeddings (
  id serial PRIMARY KEY,
  content text,
  embedding vector(384)
);
CREATE INDEX ON embeddings USING hnsw (embedding vector_cosine_ops);
```

---

## 推荐的学习路径

### Week 1: 理解基础
- 阅读 memos 源码 (API 设计)
- 阅读 blinko 源码 (本地优先)
- 完成原型设计文档

### Week 2: 深入技术栈
- 学习 Go + Gin
- 学习 Protocol Buffers + gRPC-Gateway
- 完成 API 规范设计

### Week 3: 数据库和搜索
- 学习 PostgreSQL + PG Vector
- 实现混合搜索
- 完成数据库 Schema

### Week 4: 前端和桌面
- 学习 Tauri v2
- 学习 React 18 + TypeScript
- 完成 UI 原型

### Week 5-6: AI 能力
- 学习 FastGPT 工作流
- 实现工具链和 MCP
- 完成 Agent 框架

### Week 7-8: 集成和测试
- 集成所有模块
- 编写测试用例
- 性能优化

---

## 常见问题解答

### Q1: 选择 Go 还是 Python 作为后端?
**A**: Go 更合适
- 编译性能好，部署简单
- 原生并发支持
- 内存占用少
- memos 和 WeKnora 都用 Go
- Python 可用于文档处理等专用模块

### Q2: 本地应用应该用什么数据库?
**A**: SQLite
- 零配置，开箱即用
- 全功能 SQL 支持
- memos 和 blinko 都用 SQLite
- 支持迁移到 PostgreSQL

### Q3: 如何实现向量搜索?
**A**: 推荐 PG Vector
- 与 PostgreSQL 集成
- 开源免费
- 支持多种距离指标
- HNSW 索引性能好

### Q4: 如何支持多端应用?
**A**: 参考 khoj 的模式
- 后端提供统一 API
- 各端独立实现 UI
- Web (React), Desktop (Tauri), CLI 等

### Q5: 如何集成 MCP?
**A**: 参考 blinko 的模式
- 作为 MCP 服务器，暴露工具
- 作为 MCP 客户端，连接外部工具
- 使用标准 MCP SDK

---

## 关键技术资源

### 官方文档
- **memos**: https://github.com/usememos/memos
- **blinko**: https://github.com/blinkochat/blinko
- **FastGPT**: https://github.com/labring/FastGPT
- **khoj**: https://github.com/khoj-ai/khoj
- **WeKnora**: https://github.com/Tencent/WeKnora

### 技术栈文档
- Protocol Buffers: https://protobuf.dev/
- gRPC-Gateway: https://github.com/grpc-ecosystem/grpc-gateway
- Tauri: https://tauri.app/
- tRPC: https://trpc.io/
- Prisma: https://www.prisma.io/
- PG Vector: https://github.com/pgvector/pgvector
- MCP: https://spec.modelcontextprotocol.io/

### 学习资源
- Go 官方教程: https://go.dev/tour/
- React 官方教程: https://react.dev/
- PostgreSQL 文档: https://www.postgresql.org/docs/
- SQLite 文档: https://www.sqlite.org/docs.html

---

## 后续行动项清单

- [ ] 阅读深度分析文档 (深度分析-5个参考项目.md)
- [ ] 阅读技术对比表 (技术选型对比表.md)
- [ ] 阅读代码参考 (代码实现参考.md)
- [ ] 选择技术栈并记录决策理由
- [ ] 设计数据库 Schema
- [ ] 设计 API 规范 (Protocol Buffers)
- [ ] 创建项目原型
- [ ] 建立开发环境
- [ ] 编写测试用例
- [ ] 进行性能基准测试

---

## 文档关联

本总结文档与以下文件关联:

**已有文件**:
- `/Users/huyunfei/project/Prism/specs/001-ai-notes-refactor/素材/项目分析汇总.md` (功能特性总结)

**新增文件** (本次生成):
- `/Users/huyunfei/project/Prism/specs/001-ai-notes-refactor/素材/深度分析-5个参考项目.md`
- `/Users/huyunfei/project/Prism/specs/001-ai-notes-refactor/素材/技术选型对比表.md`
- `/Users/huyunfei/project/Prism/specs/001-ai-notes-refactor/素材/代码实现参考.md`
- `/Users/huyunfei/project/Prism/specs/001-ai-notes-refactor/素材/总结索引.md` (本文件)

**相关文件**:
- `/Users/huyunfei/project/Prism/specs/001-ai-notes-refactor/plan.md` (重构计划)

---

## 版本信息

| 字段 | 值 |
|------|-----|
| 分析时间 | 2026-01-03 |
| 参考项目数 | 5 个 |
| 文档总数 | 4 份 |
| 代码示例数 | 15+ 个 |
| 深度等级 | 代码 + 架构 |
| 适用场景 | Prism Next 重构 |

---

**本文档为探索总结和索引，具体内容请参考对应的详细文档。**
